#### 改进 `asyncio` 下载脚本

- 拓展命令行接口，使得可以接受并发请求等等。

##### 增加进度条

- 为了更新进度条，各个协程结束后要立即获取结果。发现 `asyncio` 也提供了类似的函数 `asyncio.as_completed` 。

- 使用 `asyncio` 包的程序只能有一个主线程，线程中不能有阻塞型调用，因为事件循环也需要进行，因此需要将部分函数改为用 `yield from` 驱动，做异步调用。

- 一定要采取限流机制，防止发送太多的并发请求，降低系统整体性能。原先的做法是设定 `max_worker` 参数。这里的做法是创建一个 `asyncio.Semaphore` 实例，再传给函数作为参数。其内部维护一个内部的计数器，`acquire()` 时减少，`release()` 时递增。在数值为 $0$ 的时候发生阻塞。

- 也可以作为上下管理器使用。`with (yield from semaphore)` 也可以达到类似的效果，任何时候不会有过多的协程启动。